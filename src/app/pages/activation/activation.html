<div class="p-tb">
  <!-- @if (isShowAlert()) {
  <app-alert-box [isShowSuccess]="isSuccessAlert()" [alertReq]="alertObj()"></app-alert-box>
  } -->

  <div class="row">
    <div class="col">
      <div class="card shadow-premium border-0 h-100">
        <div class="card-header-premium d-flex justify-content-between align-items-center">
          <div class="header-content">
            <h5 class="mb-1 header-title"><i class="bi bi-box-seam me-2"></i>Activation Management</h5>
            <p class="header-subtitle mb-0">Create and manage subscription packages</p>
          </div>
          <button class="btn btn-add-package" data-bs-toggle="modal" data-bs-target="#addActivationModal">
            <i class="bi bi-plus-lg me-2"></i>
            <span>Add Activation</span>
          </button>
        </div>

        <div class="card-body packages-container">
          <div class="list-viewport" style="max-height: calc(100vh - 200px)">
            @if (isActivationLoading()) {
            <div class="loading-container">
              <div class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading Activations...</p>
              </div>
            </div>
            } @if (!isActivationLoading()) { @if (activationList().length == 0) {
            <div class="empty-state">
              <div class="empty-state-icon">
                <i class="bi bi-inbox"></i>
              </div>
              <h4 class="empty-state-title">No Activations Yet</h4>
              <p class="empty-state-text">Get started by creating your first activation</p>
              <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addActivationModal">
                <i class="bi bi-plus-circle me-2"></i>Add Activation
              </button>
            </div>
            } @if (activationList().length) {
            <div class="row g-4">
              @for (act of activationList(); track act.activationId) {
              <div class="col-xl-3 col-lg-4 col-md-6">
                <div class="package-card-modern">
                  <div class="package-card-header">
                    <div class="package-icon-wrapper">
                      <i class="bi bi-box-seam"></i>
                    </div>
                    <h5 class="package-name">{{ act.packageName }}</h5>
                  </div>

                  <div class="package-card-body">
                    <div class="pricing-section">
                      <div class="price-item">
                        <span class="price-label">Institute</span>
                        <span class="price-value">{{ act.instituteName }}</span>
                      </div>
                      <!-- <div class="price-divider"></div>
                                            <div class="price-item">
                                                <span class="price-label">EMI</span>
                                                <span class="price-value">â‚¹{{ act.emiTotalCost }}</span>
                                            </div> -->
                    </div>

                    <div class="features-section">
                      <div class="feature-item">
                        <i class="bi bi-calendar-check feature-icon"></i>
                        <div class="feature-content">
                          <span class="feature-label">Start Date</span>
                          <span class="feature-value">{{ act.startDate | date:'dd MMM yyyy'
                            }}</span>
                        </div>
                      </div>
                      <div class="feature-item">
                        <i class="bi bi-calendar-check feature-icon"></i>
                        <div class="feature-content">
                          <span class="feature-label">End Date</span>
                          <span class="feature-value">{{ act.endDate | date:'dd MMM yyyy'
                            }}</span>
                        </div>
                      </div>
                      <div class="feature-item">
                        <i class="bi bi-chat-dots-fill feature-icon"></i>
                        <div class="feature-content">
                          <span class="feature-label">Status</span>
                          <span class="feature-badge" [class.badge-success]="act.isActive"
                            [class.badge-danger]="!act.isActive">
                            {{ act.isActive ? 'Active' : 'Not Active' }}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="package-card-footer">
                    <button class="btn-action btn-edit" data-bs-toggle="modal" data-bs-target="#addActivationModal"
                      (click)="editActivation(act)">
                      <i class="bi bi-pencil-square"></i>
                      <span>Edit</span>
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteActivation(act.activationId)">
                      <i class="bi bi-trash-fill"></i>
                      <span>Delete</span>
                    </button>
                  </div>
                </div>
              </div>
              }
            </div>
            } }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced Modal for Add / Update Package -->
<div class="modal fade modal-lg" id="addActivationModal" data-bs-backdrop="static" tabindex="-1" role="dialog"
  aria-labelledby="addActivationModalModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content modal-modern">
      <form [formGroup]="activationForm" (ngSubmit)="createActivation()">
        <div class="modal-header modal-header-modern">
          <div>
            <h5 class="modal-title" id="addActivationModalLabel">
              Add / Update Activation
            </h5>
          </div>
          <button type="button" class="btn-close-modern" data-bs-dismiss="modal" aria-label="Close"
            (click)="cancelEdit()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-body modal-body-modern">
          <div class="form-section">
            <!-- <h6 class="section-title"><i class="bi bi-info-circle me-2"></i>Basic Information</h6> -->
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Package</label>
                <select class="form-select" formControlName="packageId">
                  <option value="">Select Package</option>
                  <option *ngFor="let i of packageMasterList()" [value]="i.packageId">{{i.packageName}}
                  </option>
                </select>
                <small class="text-danger" *ngIf="showError('packageId')">Institute required</small>
              </div>

              <div class="col-md-6">
                <label class="form-label">Institute</label>
                <select class="form-select" formControlName="instituteId">
                  <option value="">Select Institute</option>
                  <option *ngFor="let i of instituteList()" [value]="i.instituteId">{{i.name}}
                  </option>
                </select>
                <small class="text-danger" *ngIf="showError('instituteId')">Institute required</small>
              </div>
            </div>
          </div>

          <div class="form-section">
            <!-- <h6 class="section-title"><i class="bi bi-currency-rupee me-2"></i>Pricing Details</h6> -->
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Start Date</label>
                <input type="date" class="form-control" formControlName="startDate" />
                <small class="text-danger" *ngIf="showError('startDate')">Date required</small>
              </div>
              <!-- </div> -->
              <div class="col-md-6">
                <label class="form-label">End Date</label>
                <input type="date" class="form-control" formControlName="endDate" />
                <small class="text-danger" *ngIf="showError('endDate')">Date required</small>
              </div>
            </div>
          </div>

          <div class="form-section">
            <!-- <h6 class="section-title"><i class="bi bi-toggles me-2"></i>Features</h6> -->
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-check-modern">
                  <input class="form-check-input-modern" type="checkbox" formControlName="isActive" id="isActive" />
                  <label class="form-check-label-modern" for="isActive">
                    <i class="bi bi-chat-dots me-2"></i>Activation Status
                    <!-- <small class="d-block text-muted mt-1">Students will receive SMS notifications for important
                      updates</small> -->
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        @if (addUpdateLoader()) {
        <div class="modal-loading">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-2 mb-0">Processing...</p>
        </div>
        }

        <div class="modal-footer modal-footer-modern">
          @if (activationId) {
          <button class="btn btn-cancel-modern" [disabled]="addUpdateLoader()" type="button" (click)="cancelEdit()">
            <i class="bi bi-x-circle me-2"></i>Cancel
          </button>
          }
          <button class="btn btn-submit-modern" [disabled]="activationForm.invalid || addUpdateLoader()"
            [ngClass]="{ 'btn-update': activationId }" type="submit">
            <i class="bi me-2" [ngClass]="{
                'bi-plus-circle-fill': !activationId,
                'bi-check-circle-fill': activationId
              }"></i>
            {{ activationId ? 'Update Activation' : 'Create Activation' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>